---
import { getCollection, render } from "astro:content";
import { siteConfig } from "../../config";
import "../../styles/global.css";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}

const post = Astro.props;
const { Content } = await render(post);
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href={`${import.meta.env.BASE_URL}/favicon.svg`} />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={post.data.description} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap"
      rel="stylesheet"
    />
    <title>{post.data.title} | {siteConfig.name}</title>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200">
      <nav class="max-w-4xl mx-auto px-8 py-4 flex items-center justify-between">
        <a
          href={`${import.meta.env.BASE_URL}/`}
          class="font-bold text-lg hover:opacity-70 transition-opacity"
          style={`color: ${siteConfig.accentColor};`}
        >
          {siteConfig.name}
        </a>
        <div class="flex items-center gap-6">
          <a
            href={`${import.meta.env.BASE_URL}/`}
            class="text-gray-600 hover:text-black transition-colors"
          >
            Inicio
          </a>
          <a
            href={`${import.meta.env.BASE_URL}/blog/`}
            class="text-gray-600 hover:text-black transition-colors"
          >
            Blog
          </a>
        </div>
      </nav>
    </header>

    <main class="max-w-3xl mx-auto px-8 py-16">
      <!-- Back link -->
      <a
        href={`${import.meta.env.BASE_URL}/blog/`}
        class="inline-flex items-center gap-2 text-gray-600 hover:text-black mb-8 transition-colors"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="m12 19-7-7 7-7" />
          <path d="M19 12H5" />
        </svg>
        Volver al blog
      </a>

      <article class="bg-white rounded-lg border border-gray-200 p-8 md:p-12">
        <header class="mb-8 pb-8 border-b border-gray-200">
          <time
            class="text-sm text-gray-500 font-mono"
            datetime={post.data.pubDate.toISOString()}
          >
            {post.data.pubDate.toLocaleDateString("es-PE", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })}
          </time>
          <h1
            class="text-3xl md:text-4xl font-bold mt-3 leading-tight"
            style={`color: ${siteConfig.accentColor};`}
          >
            {post.data.title}
          </h1>
          <p class="text-gray-600 mt-4 text-lg">
            {post.data.description}
          </p>
        </header>

        <div class="prose prose-lg max-w-none">
          <Content />
        </div>
      </article>

      <!-- Author box -->
      <div class="mt-12 p-6 bg-white rounded-lg border border-gray-200 flex items-center gap-6">
        <img
          src={`${import.meta.env.BASE_URL}/profile.png`}
          alt={siteConfig.name}
          class="w-16 h-16 rounded-full object-cover"
        />
        <div>
          <p class="font-semibold">{siteConfig.name}</p>
          <p class="text-gray-600 text-sm">{siteConfig.title}</p>
          <a
            href={siteConfig.social.linkedin}
            target="_blank"
            class="text-sm mt-1 inline-block"
            style={`color: ${siteConfig.accentColor};`}
          >
            LinkedIn →
          </a>
        </div>
      </div>
    </main>

    <footer class="border-t border-gray-200 py-8 mt-16">
      <div class="max-w-4xl mx-auto px-8 text-center text-gray-500 text-sm">
        © {new Date().getFullYear()} {siteConfig.name}. Todos los derechos reservados.
      </div>
    </footer>
  </body>
</html>

<style is:global>
  .prose {
    color: #374151;
    line-height: 1.75;
  }
  .prose h2 {
    color: #152039;
    font-size: 1.5rem;
    font-weight: 700;
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  .prose h3 {
    color: #152039;
    font-size: 1.25rem;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }
  .prose p {
    margin-bottom: 1.25rem;
  }
  .prose ul, .prose ol {
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
  }
  .prose li {
    margin-bottom: 0.5rem;
  }
  .prose strong {
    color: #152039;
    font-weight: 600;
  }
  .prose a {
    color: #0f8992;
    text-decoration: underline;
  }
  .prose a:hover {
    opacity: 0.8;
  }
  .prose blockquote {
    border-left: 4px solid #0f8992;
    padding-left: 1rem;
    margin: 1.5rem 0;
    font-style: italic;
    color: #6b7280;
  }
  .prose code {
    background: #f3f4f6;
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }
  .prose hr {
    border: none;
    border-top: 1px solid #e5e7eb;
    margin: 2rem 0;
  }
</style>
